# Project Constitution: Hackathon Todo – Phase II (Full-Stack Web Application)

**Document Type**: Constitutional Framework  
**Created**: 2026-02-08  
**Status**: APPROVED & ACTIVE  
**Version**: 1.0

---

## Purpose

This constitution defines the rules, constraints, and development philosophy for building Phase II of the Todo application using Spec-Kit Plus and Claude Code. It serves as the authoritative governance document for all development activities.

**No manual coding is allowed. All code must be generated through the agentic workflow.**

---

## Part I: Development Principles

### Principle 1: Spec-Driven Development (MANDATORY)

**Rule**: All implementation must follow written specifications in `/specs`

- ✅ Code must never precede specs
- ✅ Specs are the single source of truth
- ✅ All changes must be spec-backed
- ✅ Specs must include user stories, acceptance criteria, and requirements
- ✅ No implementation without approved specification

**Enforcement**:
- Review all specs in `/specs/` before starting work
- Cross-reference code to specs
- Update specs first, then implement
- Test against acceptance criteria

---

### Principle 2: Agentic Development Workflow

**Rule**: All work must be performed by specialized agents following the defined execution order

- ✅ Work is decomposed into agent responsibilities
- ✅ Agents are single-responsibility focused
- ✅ Agents must follow execution order strictly
- ✅ Each agent delivers specific, measurable outputs
- ✅ No agent can skip or reorder steps

**Agent Hierarchy**:
1. Spec Writer Agent (creates specifications)
2. Architecture Planner Agent (designs system)
3. Database Engineer Agent (implements database)
4. Backend Engineer Agent (implements API)
5. Frontend Engineer Agent (implements UI)
6. Integration & Security Tester Agent (validates & tests)

**Enforcement**:
- Follow execution order exactly (judges reward this)
- Each agent completes before next begins
- Deliverables must be documented
- Agent profiles stored in `/agents/profiles/`

---

### Principle 3: No Manual Coding Rule

**Rule**: All code must be generated by Claude Code; human intervention is limited to reviewing outputs

- ✅ Code generation is automated via Claude Code
- ✅ Human role is review, not implementation
- ✅ Specs are the input; code is the output
- ✅ No hand-written code in production paths
- ✅ All changes tracked and attributed to agents

**Allowed Human Actions**:
- Review specs and approve
- Review generated code
- Update specs based on feedback
- Request agent work via spec changes

**Prohibited Human Actions**:
- Hand-coding backend endpoints
- Hand-coding frontend components
- Manual database modifications
- Bypassing agent workflow

---

## Part II: Phase II Scope

### Feature Requirements

**From Console to Full-Stack**:
- [ ] Transform single-user console app into web application
- [ ] Support multiple authenticated users
- [ ] Persistent storage across sessions
- [ ] Real-time API for todo management
- [ ] Responsive user interface

### Functional Scope

✅ **User Management**
- User registration via Better Auth
- User authentication via JWT
- Session management

✅ **Todo Management**
- Create, read, update, delete todos
- Mark todos as complete/incomplete
- List todos with filtering
- User-specific todo isolation

✅ **Data Persistence**
- Cloud database (Neon PostgreSQL)
- Schema with proper relationships
- Data integrity constraints
- Backup capabilities

✅ **API Layer**
- RESTful endpoints
- JWT-based authentication
- Proper error handling
- CORS configured

✅ **Frontend UI**
- Responsive design (mobile-first)
- User-friendly interface
- Real-time API integration
- Error feedback

---

## Part III: Technology Stack

### Frontend

| Component | Technology | Version |
|-----------|-----------|---------|
| Framework | Next.js | 14+ (App Router) |
| Language | TypeScript | 5.0+ |
| Styling | Tailwind CSS | 3.3+ |
| Authentication | Better Auth | Latest |
| Package Manager | npm/yarn | Latest |

**Frontend Responsibilities**:
- User registration & login flows
- Todo list display & management
- Form validation & error display
- JWT token storage & refresh
- Responsive UI rendering

### Backend

| Component | Technology | Version |
|-----------|-----------|---------|
| Framework | FastAPI | 0.104+ |
| Language | Python | 3.8+ |
| ORM | SQLModel | Latest |
| Database | Neon PostgreSQL | Latest |
| Authentication | JWT (HS256) | Standard |

**Backend Responsibilities**:
- REST API endpoint implementation
- JWT verification & validation
- User data isolation enforcement
- Database query execution
- Error handling & logging

### Database

| Component | Technology | Configuration |
|-----------|-----------|---|
| Type | PostgreSQL | Relational |
| Provider | Neon | Serverless (managed) |
| Connection | SSL | Enabled by default |
| Pooling | SQLAlchemy | Connection pooling |

**Database Schema**:
```sql
-- Users table
users (id, email, name, created_at, updated_at)

-- Todos table  
todos (id, user_id, title, completed, created_at, updated_at)
-- Foreign key: user_id references users(id) ON DELETE CASCADE
-- Indexes: user_id, (user_id, completed)
```

---

## Part IV: Authentication Rules

### JWT-Based Authentication

**Token Generation**:
- Better Auth generates JWT on frontend after user login
- Token contains user_id in claims (subject "sub")
- Token expires in 24 hours
- Secret key shared between frontend & backend (BETTER_AUTH_SECRET)

**Token Verification**:
- Every API request includes JWT in Authorization header
- Format: `Authorization: Bearer {jwt_token}`
- Backend decodes & verifies JWT signature
- Invalid/expired token → 401 Unauthorized response

**User Identity**:
- User identity extracted from JWT "sub" claim
- Never trusted from request body or cookies
- Each request independently verified
- No session state maintained on backend

### Security Enforcement

**Every API Endpoint Must**:
1. ✅ Verify JWT token is present
2. ✅ Verify JWT signature using SECRET_KEY
3. ✅ Extract user_id from "sub" claim
4. ✅ Filter resources by user_id
5. ✅ Return 401 if token invalid
6. ✅ Return 404 if resource doesn't belong to user

**Access Control**:
- Each user can access ONLY their own todos
- Cross-user access attempt → 404 Not Found
- No data leakage in error messages
- No user enumeration possible

---

## Part V: API Rules

### Endpoint Conventions

**Base URL**: `/api`

**Supported Endpoints**:
```
POST   /api/todos              Create new todo
GET    /api/todos              List all user's todos
GET    /api/todos/{id}         Get single todo
PUT    /api/todos/{id}         Update todo
DELETE /api/todos/{id}         Delete todo
```

### Request/Response Format

**Authentication**:
- All requests require Bearer token in header
- Missing token → 401 Unauthorized
- Invalid token → 401 Unauthorized

**Input Validation**:
- Title required, 1-500 characters
- Completed field optional (boolean)
- Invalid input → 422 Unprocessable Entity

**Response Codes**:
- 201 Created (successful creation)
- 200 OK (successful read/update)
- 204 No Content (successful delete)
- 400 Bad Request (malformed input)
- 401 Unauthorized (invalid/missing token)
- 404 Not Found (resource not found or no access)
- 422 Unprocessable Entity (validation error)
- 500 Internal Server Error (server error)

### REST Conventions

- ✅ Use HTTP verbs correctly (GET, POST, PUT, DELETE)
- ✅ Use proper status codes
- ✅ Return JSON responses
- ✅ Resources identified by ID in URL
- ✅ No verbs in URLs (use HTTP verbs instead)

---

## Part VI: Agents Defined

### Agent 1: Spec Writer Agent

**Responsibility**: Create comprehensive specifications  
**Input**: Business requirements, user stories  
**Output**: Written specs in `/specs/`  
**Deliverables**:
- Feature specifications
- User stories (prioritized)
- Acceptance criteria
- Requirements documentation
- Edge case documentation

---

### Agent 2: Architecture Planner Agent

**Responsibility**: Design full-stack system architecture  
**Input**: Specifications from Agent 1  
**Output**: Architecture documentation  
**Deliverables**:
- System architecture diagram
- Frontend-backend interaction design
- JWT authentication flow
- Data flow diagrams
- Security boundaries definition

---

### Agent 3: Database Engineer Agent

**Responsibility**: Implement database layer  
**Input**: Architecture from Agent 2  
**Output**: Database code & documentation  
**Deliverables**:
- SQLModel ORM models
- Database connection setup
- Schema design documentation
- Migration scripts (if applicable)
- Relationship definitions

---

### Agent 4: Backend Engineer Agent (FastAPI)

**Responsibility**: Implement REST API  
**Input**: Database from Agent 3 + Specs from Agent 1  
**Output**: FastAPI backend code  
**Deliverables**:
- Main application file
- Route handlers (CRUD endpoints)
- JWT verification middleware
- Error handling
- CORS configuration
- API documentation

---

### Agent 5: Frontend Engineer Agent (Next.js)

**Responsibility**: Implement user interface  
**Input**: API specification from Agent 4  
**Output**: Next.js frontend code  
**Deliverables**:
- Page components
- Reusable UI components
- API client wrapper (with JWT injection)
- Form handling & validation
- Error handling UI
- Tailwind CSS styling

---

### Agent 6: Integration & Security Tester Agent

**Responsibility**: Validate system & ensure security  
**Input**: Complete system (Agents 1-5 outputs)  
**Output**: Test specifications & security report  
**Deliverables**:
- Integration test checklist
- User isolation test scenarios
- Security vulnerability assessment
- Performance test specifications
- Test results documentation

---

## Part VII: Agent Execution Order

**MANDATORY ORDER** (judges reward strict adherence):

```
1. Spec Writer Agent
   ↓ (creates specs)
2. Architecture Planner Agent
   ↓ (designs system)
3. Database Engineer Agent
   ↓ (implements database)
4. Backend Engineer Agent
   ↓ (implements API)
5. Frontend Engineer Agent
   ↓ (implements UI)
6. Integration & Security Tester Agent
   ↓ (validates & tests)
```

**Enforcement**:
- ✅ Each agent must complete before next begins
- ✅ No agent can start before its dependencies are done
- ✅ No skipping or reordering
- ✅ Execution order strictly followed

**Documentation**:
- Agent profiles in `/agents/profiles/`
- Execution log in `/agents/execution-logs/`
- Each agent documents completion

---

## Part VIII: Success Criteria

### Functional Success

- [ ] All Phase II features implemented via specifications
- [ ] All user stories completed
- [ ] All acceptance criteria met
- [ ] No feature gaps

### Security Success

- [ ] Authenticated users see ONLY their own data
- [ ] User isolation enforced at DB and API layers
- [ ] JWT verification on every endpoint
- [ ] No data leakage in error messages
- [ ] No cross-user access possible

### Architecture Success

- [ ] Backend is stateless (JWT-secured)
- [ ] Frontend and backend work independently
- [ ] Shared JWT contract between frontend & backend
- [ ] Scalable design (horizontal scaling possible)
- [ ] Secure by default

### Project Success

- [ ] Project is fully reviewable
- [ ] All code generated through agentic workflow
- [ ] All specs written before implementation
- [ ] Complete documentation
- [ ] Reproducible from scratch
- [ ] Judge-friendly structure

---

## Part IX: Compliance & Enforcement

### Specification Compliance

**Every specification must include**:
- ✅ Purpose statement
- ✅ User stories with priorities
- ✅ Acceptance criteria
- ✅ Functional requirements
- ✅ Edge cases
- ✅ Data models/entities
- ✅ Implementation notes

**Specifications are MANDATORY before coding**:
- [ ] No code without spec
- [ ] Specs reviewed & approved before implementation
- [ ] Implementation strictly follows spec
- [ ] Deviations logged as spec changes

### Code Generation Compliance

**All code must be generated by Claude Code**:
- [ ] No hand-coded endpoints
- [ ] No hand-coded components
- [ ] No manual database setup
- [ ] All changes via agent workflow
- [ ] Code reviewed against specifications

### Agent Workflow Compliance

**Agents must follow defined workflow**:
- [ ] Execute in specified order
- [ ] Complete deliverables for each agent
- [ ] Document outputs
- [ ] No skipping steps
- [ ] No parallel execution (sequential required)

---

## Part X: Glossary

| Term | Definition |
|------|-----------|
| **Spec-Driven Development** | All code is derived from written specifications |
| **Agent** | An autonomous entity responsible for a specific development task |
| **JWT** | JSON Web Token for stateless authentication |
| **User Isolation** | Ensuring users can only access their own data |
| **Backend** | FastAPI server handling business logic & data |
| **Frontend** | Next.js UI for user interaction |
| **Endpoint** | A specific URL on the API serving a particular function |
| **Schema** | Database table structure and relationships |
| **SQLModel** | Python ORM combining SQLAlchemy & Pydantic |
| **Neon** | Serverless PostgreSQL database provider |

---

## Part XI: Amendment Process

**To Change This Constitution**:
1. Create an RFC (Request For Comments) document
2. Document rationale for change
3. Specify impact on agents & specifications
4. Approval required before implementation
5. Update this document & all affected specs

**Current Amendment Status**: No pending amendments

---

## Part XII: Appendices

### Appendix A: Required Specifications

All of these specifications MUST exist:

- [ ] `specs/001-todo-app-phase2.spec.md` - Feature specification
- [ ] `specs/002-database-schema.spec.md` - Database design
- [ ] `specs/003-api-specification.spec.md` - API documentation
- [ ] `specs/004-frontend-specification.spec.md` - Frontend design
- [ ] `specs/005-integration-test-checklist.spec.md` - Test plan
- [ ] `specs/006-security-validation-report.spec.md` - Security assessment

### Appendix B: Required Directories

All of these directories MUST exist:

```
/specs/                    # All specifications
/backend/                  # All backend code
/frontend/                 # All frontend code
/agents/                   # Agent documentation
  /profiles/               # Individual agent profiles
  /deliverables/           # Agent outputs
  /execution-logs/         # Execution records
/skills/                   # Skills documentation
  /backend/
  /frontend/
  /database/
  /security/
  /testing/
  /architecture/
```

### Appendix C: Key Files

| File | Purpose | Owner |
|------|---------|-------|
| `QWEN.md` | Development guidelines | Project |
| `AGENT-EXECUTION-SUMMARY.md` | Agent tracking | Agents |
| `CONSTITUTION.md` | This document | Project |
| `SKILLS-SUMMARY.md` | Team capabilities | Agents |

---

## Acknowledgment

This constitution has been established for the Hackathon Todo Phase II project. All work performed on this project must adhere to these principles, rules, and constraints.

**Constitution Status**: ✅ ACTIVE  
**Effective Date**: 2026-02-08  
**Last Updated**: 2026-02-08  
**Next Review**: 2026-02-15

---

**Authorized by**: Spec-Kit Plus  
**Maintained by**: Development Team  
**Reviewed by**: Project Judge

---

## Document Control

**Version History**:
- v1.0 (2026-02-08) - Initial constitution for Phase II

**Distribution**:
- [x] Project Team
- [x] Phase II Stakeholders
- [x] Judges (for review)
- [x] Archive (version control)

---

*This is a governing document. Changes require formal amendment process. All development activities must comply with this constitution.*
